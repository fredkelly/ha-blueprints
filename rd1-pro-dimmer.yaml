blueprint:
  name: Candeo C-ZB-RD1P (REM or DPM mode) - on/off and dimmer
  description: >

  domain: automation
  homeassistant:
    min_version: 2024.6.0
  input:
    device_section:
      name: Device & Target Selection
      icon: mdi:devices
      description: Select your RD1P device, target lights, and mode helper
      input:
        remote_device:
          name: C-ZB-RD1P Remote Device
          description: The C-ZB-RD1P device in remote mode or dual purpose mode.
          selector:
            device:
              filter:
                - model_id: C-ZB-RD1P-REM
                - model_id: C-ZB-RD1P-DPM

        target_lights:
          name: Target Lights
          description: Light, light group, or area to control with the rotary remote
          selector:
            target:
              entity:
                domain: light

    control_section:
      name: Control Settings
      icon: mdi:tune
      description: Configure how much each rotation step changes your lights
      input:
        brightness_step:
          name: Brightness Step
          description: How much to change brightness per rotation step (1-50%)
          default: 10
          selector:
            number:
              min: 1
              max: 50
              unit_of_measurement: "%"

mode: single
max_exceeded: silent

variables:
  target_lights: !input target_lights

triggers:
  # Single Press - Toggle
  - trigger: device
    device_id: !input remote_device
    domain: mqtt
    type: action
    subtype: pressed
    id: toggle_lights

  # Rotation Actions
  - trigger: device
    device_id: !input remote_device
    domain: mqtt
    type: action
    subtype: started_rotating_right
    id: rotate_right

  - trigger: device
    device_id: !input remote_device
    domain: mqtt
    type: action
    subtype: rotating_right
    id: rotate_right

  - trigger: device
    device_id: !input remote_device
    domain: mqtt
    type: action
    subtype: started_rotating_left
    id: rotate_left

  - trigger: device
    device_id: !input remote_device
    domain: mqtt
    type: action
    subtype: rotating_left
    id: rotate_left

action:
  - choose:
      # Toggle Lights
      - conditions:
          - condition: trigger
            id: toggle_lights
        sequence:
          - action: light.toggle
            target: "{{ target_lights }}"

      # Rotate Right
      - conditions:
          - condition: trigger
            id: rotate_right
	sequence:
	  - action: light.turn_on
	    target: "{{ target_lights }}"
	    data:
	      brightness_step_pct: "{{ brightness_step }}"

      # Rotate Left
      - conditions:
          - condition: trigger
            id: rotate_left
	sequence:
	  - action: light.turn_on
	    target: "{{ target_lights }}"
	    data:
	      brightness_step_pct: "{{ -brightness_step }}"
